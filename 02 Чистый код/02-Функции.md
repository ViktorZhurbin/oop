# Функции


## Компактность

Функции должны быть компактными. Желательно, чтобы длина функции не превышала 20 строк.

Блоки `if/else`, `while` и т.д. должны состоять из одной строки, в которой обычно содержится вызов функции. В этом случае вызываемой функции модно присвоить удобное имя.

Функции не должны содержать вложенных структур.


## Правило одной операции

Функция должна выполнять только одну операцию.

Чтобы определить, что функция выполняет более одной операции, попробуйте извлечь из неё другую функцию, которая бы не была простой переформулировкой реализации.


## Один уровень абстракции на функцию

Чтобы убедиться, что функция выполняет только одну операцию, проверьте, что все команды находятся на одном уровне абстракции.

- `getHtml()` — находится на очень высоком уровне абстракции
- `pagePathName = PathParser.render(pagePath))` — средний уровень
- `.append("\n")` — низкий уровень

Смешение уровней абстракции внутри функции создано путаницу: неясно, это выражение - важная концепция или второстепенная подробность.


## Чтение кода сверху вниз

За каждой функцией должны следовать функции следующего уровня абстракции. Это позволяет читать код сверху вниз, спускаясь по уровням абстракции.

Этот прием играет ключевую роль для сохраняя коротких функций, выполняющих только одну операцию.


## Содержательные имена

Длинное содержательное имя лучше короткого невразумительного. Чем меньше и специализированнее функция, тем легче подобрать ей содержательное имя.


## Аргументы функций

Аргументы усложняют функцию, делают ее сложной для тестирования.

В идеальном случае количество аргументов равно нулю. Больше, чем 3 аргумента использовать не стоит.


### Аргументы-флаги
`render(true)` - флаги усложняют запись метода и говорят о том, что функция выполняет больше, чем одну операцию.


### Объекты как аргументы

Если функция должна получать больше двух или трёх аргументов, некоторые из них стоит упаковать в отдельном объекте - скорее всего, вместе они образуют некое единство.

```
// плохо
const initPopup = (
  node,
  closeOnEsc=false,
  closeWithAnimation=false
) => {
  /* ... */
}

// хорошо
const initPopup = (node, options={}) => {
  const {
    closeOnEsc=false,
    closeWithAnimation=false
  } = options
  /* ... */
}
```


### Глаголы и ключевые слова

В унарных функциях имя функции и аргумент должны образовывать пару глагол/существительное:

```
// понятно, что имя куда-то записывается
write(name)

// ещё лучше: понятно, что имя записывается в поле какой-то структуры
writeField(name)
```

Последняя запись - пример использования ключевых слов в имени функции.


## Побочные эффекты

Если без побочных эффектов никак не обойтись, это должно быть четко оговорено в имени функции, хотя это безусловно нарушает правило одной операции.

`checkPassword` VS `checkPasswordAndInitializeSession`


## Разделение команд и запросов

Либо функция изменяет состояние объекта, либо возвращает информацию о нём. Совмещение двух операций часто может путаницу.


### Обработка ошибок как одна операция

Функция, обрабатывающая ошибки, ничего другого делать не должна.

Выделяйте `try/catch` в отдельные функции.


## Не повторяйтесь (DRY)

Дублирование увеличивает объем кода, усложняет поддержку и изменение кода, увеличивает вероятность ошибки


## Структурное программирование

Каждая функция и каждый блок внутри функции должны иметь одну точку входа и одну точку выхода. Выполнение этого правила означает, что функция должна содержать только одну команду return, в циклах не должны использоваться команды break
или continue, а команды goto не должны использоваться никогда и ни при каких условиях.

Хотя мы с симпатией относимся к целям и методам структурного программирования, в очень компактных функциях эти правила не приносят особой пользы.

Только при увеличении объема функций их соблюдение обеспечивает существенный эффект.

Итак, если ваши функции остаются очень компактными, редкие вкрапления множественных return, команд break и continue не принесут вреда, а иногда даже повышают выразительность по сравнению с классической реализацией с одной точкой входа и одной точкой выхода. С другой стороны, команда goto имеет смысл только в больших функциях, поэтому ее следует избегать.


## Как научиться писать такие функции

"Дядюшка Боб":
Когда я пишу свои функции, они сначала получаются длинными и сложными. Затем я выделяю новые функции, изменяю имена, устраняю повторы и т.д., следуя правилам, изложенным в этой главе. Я не забываю их так сначала. И вообще не думаю, что кому-нибудь это под силу.

Не забывайте, что ваша настоящая цель -рассказать историю системы, а написанные функции должны четко складываться в понятный и точный язык, который поможет вам в этом.
